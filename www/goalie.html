<!DOCTYPE html>

<meta charset="utf-8" />

<title>WebSocket Test</title>

<script language="javascript" type="text/javascript">

  var wsUri = "ws://192.168.0.232:6666";
  var output;

  function init()
  {
    output = document.getElementById("output");
    testWebSocket();
  }

  function testWebSocket()
  {
    websocket = new WebSocket(wsUri);
    websocket.onopen = function(evt) { onOpen(evt) };
    websocket.onclose = function(evt) { onClose(evt) };
    websocket.onmessage = function(evt) { onMessage(evt) };
    websocket.onerror = function(evt) { onError(evt) };
  }

  function onOpen(evt)
  {
    writeToScreen("CONNECTED");
    doSend("WebSocket rocks");
  }

  function onClose(evt)
  {
    writeToScreen("DISCONNECTED");
  }

  function UpdateFields(message)
  {
    name = message.substr(0, 4);
    value = message.substr(5, message.length - 5);
    
    elements = document.getElementsByName(name);
  
    for (var i = 0; i < elements.length; ++i) {
        elements[0].value = value;
    }
  }
  
  function onMessage(evt)
  {
    writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
    
    var values = evt.data.split(";");
    
    for (var i = 0; i < values.length; ++i) {
        UpdateFields(values[i]);
    }
    
    //websocket.close();
  }

  function onError(evt)
  {
    writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
  }

  function doSend(message)
  {
    writeToScreen("SENT: " + message); 
    websocket.send(message);
  }

  function writeToScreen(message)
  {
    var pre = document.createElement("p");
    pre.style.wordWrap = "break-word";
    pre.innerHTML = message;
    output.appendChild(pre);
  }
  
  function UpdateField(elementName, elementId, value)
  {
    document.getElementById(elementId).value = value;
    websocket.send(elementName + ":" + value + ";");
  }

  
  
  window.addEventListener("load", init, false);

</script>

<h2>WebSocket Test</h2>

HUE min
<input name="hMin" id="hmin_rng" type="range" min=0 max=360 value=0 onchange="UpdateField('hMin', 'hmin_text', value)">
<input name="hMin" id="hmin_text" type="text" min=0 max=360 value=0 onchange="UpdateField('hMin', 'hmin_rng',  value)"><br>

HUE max
<input name="hMax" id="hmax_rng" type="range" min=0 max=360 value=0 onchange="UpdateField('hMax', 'hmax_text', value)">
<input name="hMax" id="hmax_text" type="text" min=0 max=360 value=0 onchange="UpdateField('hMax', 'hmax_rng',  value)"><br>

Saturation min
<input name="sMin" id="smin_rng" type="range" min=0 max=100 value=0 onchange="UpdateField('sMin', 'smin_text', value)">
<input name="sMin" id="smin_text" type="text" min=0 max=100 value=0 onchange="UpdateField('sMin', 'smin_rng',  value)"><br>

Saturation max
<input name="sMax" id="smax_rng" type="range" min=0 max=100 value=0 onchange="UpdateField('sMax', 'smax_text', value)">
<input name="sMax" id="smax_text" type="text" min=0 max=100 value=0 onchange="UpdateField('sMax', 'smax_rng',  value)"><br>

Value min
<input name="vMin" id="vmin_rng" type="range" min=0 max=100 value=0 onchange="UpdateField('vMin', 'vmin_text', value)">
<input name="vMin" id="vmin_text" type="text" min=0 max=100 value=0 onchange="UpdateField('vMin', 'vmin_rng',  value)"><br>

Value max
<input name="vMax" id="vmax_rng" type="range" min=0 max=100 value=0 onchange="UpdateField('vMax', 'vmax_text', value)">
<input name="vMax" id="vmax_text" type="text" min=0 max=100 value=0 onchange="UpdateField('vMax', 'vmax_rng',  value)"><br>

<div id="output"></div>

</html> 